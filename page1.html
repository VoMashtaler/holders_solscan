<!DOCTYPE html>
<html>
<head>
  <title>Token Holders</title>
  <style>
    /* Some CSS for styling the page */
    /* ... */
  </style>
</head>
<body>
  
  <h1>Token Holders</h1>
  <form>
    <label>
      Token Address:
      <input type="text" id="token-address" placeholder="Enter token address">
    </label>
    <button type="button" id="get-holders-button">Get Holders</button>
  </form>
  <br>
  <div id="holders-list"></div>

  <script>
    // Get references to the form elements
    const tokenAddressInput = document.getElementById("token-address");
    const getHoldersButton = document.getElementById("get-holders-button");
    const holdersList = document.getElementById("holders-list");

    // Add an event listener to the button
    getHoldersButton.addEventListener("click", getHolders);

    function getHolders() {
        let tokenAddress = tokenAddressInput.value;
        let limit = 100;
        let offset = 0;
        let holders = [];
        fetch(`https://public-api.solscan.io/token/holders?tokenAddress=${tokenAddress}&limit=${limit}&offset=${offset}`)
              .then(response => response.json())
              .then(data => {
                holders = holders.concat(data.data);
                total = data.total
                while (offset <= total) {
                  offset += limit;
                  fetch(`https://public-api.solscan.io/token/holders?tokenAddress=${tokenAddress}&limit=${limit}&offset=${offset}`)
                      .then(response => response.json())
                      .then(data => {
                        holders = holders.concat(data.data);
                        if(offset > total){
                            createCSV(holders);
                        }
                      })
                      .catch(error => {
                        console.error(error);
                      });
                }
              })
              .catch(error => {
                console.error(error);
              });
    }

    function createCSV(holders) {
        let csvContent = "data:text/csv;charset=utf-8,";
        holders.forEach(function(holder) {
            csvContent += `${holder.address}, ${holder.amount} \n`;
        });

        var encodedUri = encodeURI(csvContent);
        var link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "holders.csv");
        document.body.appendChild(link); // Required for FF

        link.click();
    }
  </script>
</body>
</html>
